<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Prices</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1e1e2f;
            color: #ffffff;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .crypto-widget {
            background: #282846;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            padding: 20px;
            max-width: 400px;
            width: 100%;
        }

        .crypto-widget h2 {
            text-align: center;
            color: #f39c12;
            margin-bottom: 20px;
        }

        .crypto {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 10px 0;
            background: #3e3e5e;
            border-radius: 8px;
        }

        .crypto-name {
            font-size: 16px;
            font-weight: bold;
        }

        .crypto-price {
            font-size: 16px;
            color: #2ecc71;
        }
    </style>
</head>

<body>
    <div id="crypto" class="crypto-widget">
        <h2>Crypto Prices</h2>
        <p>Last refresh: <span id="refresh-date">-</span></p>
        <!--<button onclick="refresh()">Refresh</button>
        <div id="cryptos">

        </div>-->
        <!--<div>
            <button onclick="filterBalances()">Filter Balances</button>
            <button onclick="showAll()">Show All</button>
        </div>-->
    </div>

    <script>
        $(function () {

            getKurs((kurs) => {
                refresh(kurs);

                setInterval(() => {
                    refresh(kurs);
                }, 1000);
            });
        });

        function showAll() {
            $('.crypto').show();
        }

        function filterBalances() {
            $('.crypto[type!="balance"]').hide();
            $('.crypto[type="balance"]').show();
        }

        function refresh(kurs) {
            const list = $('<div id="list"></div>')

            list.append(`
                <div class="crypto" type="price">
                    <span class="crypto-name">EURO/USD</span>
                    <span class="crypto-price">${parseFloat(kurs).toFixed(6)}€</span>
                </div>
            `);

            $.ajax({
                url: 'https://api.binance.com/api/v3/ticker/price?symbols=["BTCEUR","ETHEUR","BONKUSDT"]',
                method: 'GET',
                success: function (data) {

                    

                    //$('#cryptos').empty();
                    data.forEach(crypto => {

                        crypto.symbol = crypto.symbol.replaceAll('EUR', '').replaceAll('USDT', '');

                        list.append(`
                            <div class="crypto" type="price">
                                <span class="crypto-name">${crypto.symbol}</span>
                                <span class="crypto-price">${crypto.symbol == 'BONK' ? parseFloat(crypto.price * kurs).toFixed(8) : parseFloat(crypto.price).toFixed(2)}€</span>
                            </div>
                        `);

                        if (crypto.symbol == "BTC") {
                            list.append(`
                                <div class="crypto" type="balance" person="Mom">
                                    <span class="crypto-name">${crypto.symbol} Mom</span>
                                    <span class="crypto-price">${parseFloat(crypto.price * 0.00125713).toFixed(2)}€</span>
                                </div>
                            `);
                            list.append(`
                                <div class="crypto" type="balance" person="Bro">
                                    <span class="crypto-name">${crypto.symbol} Bro</span>
                                    <span class="crypto-price">${parseFloat(crypto.price * 0.00101913).toFixed(2)}€</span>
                                </div>
                            `);
                        } else if (crypto.symbol == "ETH") {
                            list.append(`
                                <div class="crypto" type="balance" person="Dome">
                                    <span class="crypto-name">${crypto.symbol} Dome</span>
                                    <span class="crypto-price">${parseFloat(crypto.price * 0.01298029).toFixed(2)}€</span>
                                </div>
                            `);
                        } else if (crypto.symbol == "BONK") {
                            list.append(`
                                <div class="crypto" type="balance" person="Mom">
                                    <span class="crypto-name">${crypto.symbol} Mom</span>
                                    <span class="crypto-price">${parseFloat(crypto.price * kurs * 2178649.23747276).toFixed(2)}€</span>
                                </div>
                            `);
                        }
                    });


                    $.ajax({
                        url: 'https://api.kaspa.org/info/price',
                        method: 'GET',
                        success: function (kaspa) {

                            list.append(`
                                <div class="crypto" type="price">
                                    <span class="crypto-name">KAS</span>
                                    <span class="crypto-price">${parseFloat(kaspa.price * kurs).toFixed(6)}€</span>
                                </div>
                            `);

                            list.append(`
                                <div class="crypto" type="balance" person="Mom">
                                    <span class="crypto-name">KAS Mom</span>
                                    <span class="crypto-price">${parseFloat(kaspa.price * kurs * 382.42081862).toFixed(2)}€</span>
                                </div>
                            `);

                            const sumMom = sumPerson(list, 'Mom');
                            const sumBro = sumPerson(list, 'Bro');
                            const sumDome = sumPerson(list, 'Dome');

                            list.append(`
                                <div class="crypto" type="sum" style="background: #383a83;">
                                    <span class="crypto-name">Mom Total Balance</span>
                                    <span class="crypto-price">${sumMom.toFixed(2)}€</span>
                                </div>
                            `);

                            list.append(`
                                <div class="crypto" type="sum" style="background: #383a83;">
                                    <span class="crypto-name">Bro Total Balance</span>
                                    <span class="crypto-price">${sumBro.toFixed(2)}€</span>
                                </div>
                            `);

                            list.append(`
                                <div class="crypto" type="sum" style="background: #383a83;">
                                    <span class="crypto-name">Dome Total Balance</span>
                                    <span class="crypto-price">${sumDome.toFixed(2)}€</span>
                                </div>
                            `);

                            $('#list').remove();
                            $('#crypto').append(list);

                            const date = new Date();
                            const formattedDate = date.toISOString().slice(0, 19).replace("T", " ");

                            $('#refresh-date').html(formattedDate);
                        },
                        error: function (error) {
                            console.error(error);
                        }
                    });
                },
                error: function (error) {
                    console.error(error);
                }
            });

        }

        function sumPerson(list, person) {
            const sum = list.find(`.crypto[person="${person}"] .crypto-price`).toArray().reduce((total, element) => {
                const price = parseFloat($(element).text().replace('€', '').trim());
                return total + price;
            }, 0);

            return sum;
        }

        function getKurs(callback) {
            $.ajax({
                url: 'https://api.binance.com/api/v3/ticker/price?symbols=["BTCUSDT","BTCEUR"]',
                method: 'GET',
                success: function (btc) {

                    var eur = btc.find(x => x.symbol == "BTCEUR").price;
                    var usd = btc.find(x => x.symbol == "BTCUSDT").price;

                    var kurs = eur / usd;

                    callback(kurs);
                },
                error: function (error) {
                    console.error(error);
                }
            });
        }
    </script>
</body>

</html>